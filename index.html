<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa (wrapper) — Pantalla de carga 3D</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; background:#fff; overflow:hidden; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    body { perspective: 1200px; }

    #map-frame {
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      transform: scale(0.86) rotateX(18deg);
      transform-origin: center top;
      transition: transform 900ms cubic-bezier(.22,.9,.35,1), opacity 900ms ease;
      opacity: 0.0;
      will-change: transform, opacity;
      background: #eee;
    }
    #map-frame.show {
      transform: scale(1) rotateX(0deg);
      opacity: 1;
    }

    #loader {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:12000;
      background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(245,245,245,1) 60%, rgba(240,240,240,0.95) 100%);
      transition: opacity 900ms ease, transform 900ms cubic-bezier(.22,.9,.35,1);
      transform-origin: center center;
      will-change: opacity, transform;
    }

    .logo-3d {
      width: min(44vmin, 520px);
      max-width: 520px;
      height: auto;
      transform-style: preserve-3d;
      display:block;
      perspective: 900px;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.25));
    }

    #logo {
      width:100%;
      height:auto;
      display:block;
      transform-origin: center center;
      animation: spin3d 2.6s linear infinite;
      will-change: transform;
      backface-visibility: hidden;
    }

    @keyframes spin3d {
      0%   { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1); }
      25%  { transform: rotateX(10deg) rotateY(120deg) rotateZ(30deg) scale(1.02); }
      50%  { transform: rotateX(20deg) rotateY(240deg) rotateZ(180deg) scale(1.03); }
      75%  { transform: rotateX(10deg) rotateY(360deg) rotateZ(270deg) scale(1.01); }
      100% { transform: rotateX(0deg) rotateY(480deg) rotateZ(360deg) scale(1); }
    }

    #loader.hide {
      opacity: 0;
      transform: scale(1.8) translateZ(400px);
      pointer-events: none;
    }

    #hint {
      position: fixed;
      bottom: 18px;
      left: 18px;
      z-index: 12500;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: rgba(255,255,255,0.85);
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      font-size: 13px;
      color: #222;
      display: none;
    }
    #hint.show { display:block; }

    @media (max-width:600px) {
      .logo-3d { width: min(58vmin, 360px); }
    }
  </style>
</head>
<body>
  <iframe id="map-frame" src="Mapa_viaje_lisboa.html" title="Mapa de viaje — Lisboa"></iframe>

  <div id="loader" aria-hidden="false" role="status" aria-label="Pantalla de carga">
    <div class="logo-3d" aria-hidden="true">
      <img id="logo" src="logo.png" alt="Logo animado">
    </div>
  </div>

  <div id="hint">Mapa listo — haz clic para explorar</div>

  <script>
    (function(){
      var iframe = document.getElementById('map-frame');
      var loader = document.getElementById('loader');
      var hint = document.getElementById('hint');
      var minShow = 2200; 
      var start = performance.now();

      function reveal() {
        var elapsed = performance.now() - start;
        var remaining = Math.max(0, minShow - elapsed);
        setTimeout(function(){
          loader.classList.add('hide');
          requestAnimationFrame(function(){
            iframe.classList.add('show');
          });
          setTimeout(function(){
            hint.classList.add('show');
            setTimeout(function(){
              loader.style.display = 'none';
            }, 800);
          }, 900);
        }, remaining);
      }

      iframe.addEventListener('load', function(){
        try {
          var cw = iframe.contentWindow;
          var checkCount = 0;
          var maxChecks = 40;
          var checker = setInterval(function(){
            checkCount++;
            try {
              if (cw && cw.document && cw.document.getElementById('map')) {
                clearInterval(checker);
                reveal();
              } else if (checkCount > maxChecks) {
                clearInterval(checker);
                reveal();
              }
            } catch(e) {
              clearInterval(checker);
              reveal();
            }
          }, 150);
        } catch(e) {
          reveal();
        }
      });

      setTimeout(function(){
        if (!iframe.classList.contains('show')) {
          reveal();
        }
      }, 6000);

      loader.addEventListener('click', function(){
        reveal();
      });
    })();
  </script>
</body>
</html>